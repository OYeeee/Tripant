<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link th:href="@{/css/mypage/chNick.css}" rel="stylesheet" type="text/css">
<script type="text/javascript" th:src="@{/js/mypage/chNick/check.js}"></script>
<script type="text/javascript" th:src="@{/js/mypage/chNick/active.js}"></script>
<head th:replace="~{common/header :: head('닉네임 변경')}"></head>
<script th:inline="javascript">
$(loadedHandler);
function loadedHandler(){
	//버튼:hover css
	$('.btn').hover(function(){
		if(!$(this).prop('disabled')){
			$(this).css('background-color', 'black');
			$(this).css('color', 'white');
		}
	}, function(){
		if(!$(this).prop('disabled')){
			$(this).css('background-color', 'lightgrey');
			$(this).css('color', 'black');
		}
	});
	//닉네임 검사
	$("input#memNick").on("keyup", nickCheckHandler);
	//돌아가기 버튼
	$('.btn.back').on('click', backClickHandler);
	//저장 버튼
	$('.btn.save').on('click', saveClickHandler);
}
//마이페이지 돌아가기
function backClickHandler(){
	location.href = '/my/home';
}
//닉네임 저장
function saveClickHandler(){
	$.ajax({
		url: '/save/nick', 
		type: 'post', 
		data: $('#memNick'), 
		success: function(result){
			if(result == 1){
				alert('닉네임이 변경되었습니다.');
				location.href = '/my/home';
			}else{
				alert('닉네임 변경 중 오류가 발생했습니다.\n관리자에게 문의해주시기 바랍니다.');
			}
		}, 
		error: ajaxErrorHandler
	});
}
</script>
<body>
	<div class="header" th:insert="~{common/header :: wrap-header}"></div>
	<div class="wrap-main">
		<form id="frm-chNick" action="/chNick" method="post">
			<section class="flex chNick">
				<div class="chNick title">닉네임 변경</div>
				<div th:replace="~{member/fragment :: inputchk('', 닉네임, memNick, text, '한글 2~8자', 4)}"></div>
				<div id="exist-nick" class="hide"><p style="color:red;">중복된 닉네임입니다.</p></div>
				<div class="flex choose">
					<button type="button" class="btn back">돌아가기</button>
					<button type="button" class="btn save" disabled>저장</button>
				</div>
			</section>
		</form>
	</div>
	<div class="footer" th:insert="~{common/footer :: wrap-footer}"></div>
</body>
</html>